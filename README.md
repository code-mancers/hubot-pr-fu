# hubot-pr-status

[Might not be fully accurate; haven't checked]

hubot-pr-status is a chat bot built on the [Hubot][hubot] framework. It was
initially generated by [generator-hubot][generator-hubot].

[hubot]: http://hubot.github.com
[generator-hubot]: https://github.com/github/generator-hubot

### Running hubot-pr-status Locally

You can test your hubot by running the following, however some plugins will not
behave as expected unless the [environment variables](#configuration) they rely
upon have been set. The app has two components: 1. The bot 2. The
Sinatra app that aggregates GitHub data.

You can start hubot-pr-status locally by running:

    % cd ruby_app
    % bundle install
    % ruby app.rb

In another window:

    % bin/hubot -a slack

### Notes

* There might be some inconsistency with determining the conflict of
  PRs. GitHub's API returns a `mergeable` key in the response that has
  three possible states: `true`, `false` and `nil`. `nil` state means
  that the mergeability of that PR has not yet been determined, and a
  background job has been scheduled. For reasons of making the logic
  simpler, we don't display information about these `nil` state PRs. So
  there might be a rare case where the total number of PRs in `status
  all` command doesn't match with the sum of mergeable PRs and
  non-mergeable PRs in the same command's response.

### Commands/Features

#### User specific commands

`status all`

This command returns the PR stats for the repo. This information would
include:

1. Total open PRs
2. Total PRs which are mergeable and those which are not
3. List of users who have open PRs and links to each of those

`status conflicts`

This command returns all the PRs which have merge conflicts. This has
more detailed information for those compared to `status all` command.
The title, PR number, link to that PR, assignee and the username who
opened this PR is included in the information.

`status <username>`

This command returns all the PRs opened by this user. This includes all
open PRs which are mergeable and non-mergeable. The `username` is
assumed to be a valid Github username. For now, there is no
authorization or authentication built-in. Another assumption is that a
username in lowercase is same as capitalized or camelcased. That is, for
a username `bootstrap`, the users `Bootstrap`, `bootStrap` are the same.

One caveat is that the robot will treat every string after `status`
other than `all` and `conflicts` as a username. So, don't abuse this.
Adding a way to make this better is in the works.

### Configuration


Some env vars are assumed to exist:

* HUBOT_SLACK_TOKEN (Get this from Slack account page)
  [Read this for steps to obtain a slack token and set the bot name]( #getting-a-slack-token )
  steps](#getting-a-slack-token) to know the name of the bot.
* GH_AUTH_TOKEN (Get this from Github)
* HUBOT_VT_GITHUB_ORG
* HUBOT_VT_GITHUB_REPO

The `org` and `repo` are the username or organization name and the
repository's name respectively. These have to be added to the
environment based on which project you want to configure the robot to
work with.

#### Getting a Slack Token
1. Signin into Slack via https://slack.com/signin
2. Head to https://<teamname>.slack.com/services/new/bot
3. Register a new bot with whatever name you want
4. Save the service, and you'll be shown the API key. Grab this key and
   set it to `HUBOT_SLACK_TOKEN`

### Contribution

An example script is included at `scripts/example.coffee`, so check it out to
get started, along with the [Scripting Guide](scripting-docs).

[scripting-docs]: https://github.com/github/hubot/blob/master/docs/scripting.md
